module.exports=[71568,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},790,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(11857);a.n(d("[project]/node_modules/next/dist/client/app-dir/link.js <module evaluation>"))},84707,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(11857);a.n(d("[project]/node_modules/next/dist/client/app-dir/link.js"))},97647,a=>{"use strict";a.i(790);var b=a.i(84707);a.n(b)},95936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return i},useLinkStatus:function(){return h.useLinkStatus}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(71568),g=a.r(7997),h=f._(a.r(97647));function i(a){let b=a.legacyBehavior,c="string"==typeof a.children||"number"==typeof a.children||"string"==typeof a.children?.type,d=a.children?.type?.$$typeof===Symbol.for("react.client.reference");return!b||c||d||(a.children?.type?.$$typeof===Symbol.for("react.lazy")?console.error("Using a Lazy Component as a direct child of `<Link legacyBehavior>` from a Server Component is not supported. If you need legacyBehavior, wrap your Lazy Component in a Client Component that renders the Link's `<a>` tag."):console.error("Using a Server Component as a direct child of `<Link legacyBehavior>` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's `<a>` tag.")),(0,g.jsx)(h.default,{...a})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},23878,a=>{"use strict";var b=a.i(16349),c=a.i(18558);function d(a){if(!a)return null;let b=a.replace(/[(),]/g," ").replace(/\s+/g," ").trim();return b.length>0?b:null}async function e(){let a=await (0,b.createClient)(),[c,d,e,f]=await Promise.all([a.from("review_contractors").select("*",{count:"exact",head:!0}),a.from("review_data").select("*",{count:"exact",head:!0}),a.from("review_analysis").select("*",{count:"exact",head:!0}),a.from("review_articles").select("*",{count:"exact",head:!0})]),g=c.count||0,h=d.count||0,i=e.count||0,j=f.count||0;return{contractors:g,reviews:h,analyses:i,articles:j,analysisRate:g>0?i/g*100:0,articleRate:g>0?j/g*100:0}}async function f(a,c=1,d=20){let e=await (0,b.createClient)(),g="review_analysis(id)",h="review_articles(id)";a?.hasAnalysis&&(g="review_analysis!inner(id)"),a?.hasArticle&&(h="review_articles!inner(id)");let i=e.from("review_contractors").select(`
      id,
      business_name,
      rating,
      review_count,
      city,
      state,
      last_synced_at,
      ${g},
      ${h}
    `,{count:"exact"});a?.city&&(i=i.ilike("city",`%${a.city}%`)),a?.state&&(i=i.eq("state",a.state)),a?.hasReviews&&(i=i.gt("review_count",0)),a?.minRating!==void 0&&(i=i.gte("rating",a.minRating)),a?.maxRating!==void 0&&(i=i.lte("rating",a.maxRating)),a?.search&&(i=i.ilike("business_name",`%${a.search}%`));let j=(c-1)*d;i=i.range(j,j+d-1).order("rating",{ascending:!1,nullsFirst:!1});let{data:k,count:l,error:m}=await i;if(m)throw console.error("Error fetching contractors:",m),m;return{data:(k||[]).map(a=>{let{review_analysis:b,review_articles:c,review_count:d,...e}=a;return{...e,reviewCount:d||0,hasAnalysis:Array.isArray(b)&&b.length>0,hasArticle:Array.isArray(c)&&c.length>0}}),total:l||0}}async function g(a){let c=await (0,b.createClient)(),{data:d,error:e}=await c.from("review_contractors").select(`
      *,
      review_data(*),
      review_analysis(*),
      review_articles(*)
    `).eq("id",a).single();if(e){if("PGRST116"===e.code)return null;throw console.error("Error fetching contractor detail:",e),e}return d?{...d,reviews:d.review_data||[],analysis:d.review_analysis?.[0]||null,article:d.review_articles?.[0]||null}:null}async function h(a,c=1,e=20){let f=await (0,b.createClient)(),g=(c-1)*e,i=g+e-1,j=d(a?.search),k=f.from("review_articles").select(`
      id,
      title,
      slug,
      content_markdown,
      status,
      generated_at,
      contractor:review_contractors(id, business_name, city, state)
    `,{count:"exact"});a?.status&&(k=k.eq("status",a.status)),j&&(k=k.or(`title.ilike.%${j}%,contractor.business_name.ilike.%${j}%`));let l=a?.sort||"generated_desc";switch(l){case"generated_asc":k=k.order("generated_at",{ascending:!0});break;case"title_asc":k=k.order("title",{ascending:!0});break;case"title_desc":k=k.order("title",{ascending:!1});break;default:k=k.order("generated_at",{ascending:!1})}k=k.range(g,i);let{data:m,count:n,error:o}=await k;if(o&&j){let b=f.from("review_articles").select(`
        id,
        title,
        slug,
        content_markdown,
        status,
        generated_at,
        contractor:review_contractors(id, business_name, city, state)
      `,{count:"exact"});switch(a?.status&&(b=b.eq("status",a.status)),b=b.ilike("title",`%${j}%`),l){case"generated_asc":b=b.order("generated_at",{ascending:!0});break;case"title_asc":b=b.order("title",{ascending:!0});break;case"title_desc":b=b.order("title",{ascending:!1});break;default:b=b.order("generated_at",{ascending:!1})}b=b.range(g,i);let c=await b;m=c.data,n=c.count,o=c.error}if(o)throw console.error("Error fetching articles:",o),o;let p=(m||[]).map(a=>({...a,contractor:a.contractor}));return"contractor_asc"===l?p=p.sort((a,b)=>(a.contractor?.business_name||"").localeCompare(b.contractor?.business_name||"")):"contractor_desc"===l&&(p=p.sort((a,b)=>(b.contractor?.business_name||"").localeCompare(a.contractor?.business_name||""))),{data:p,total:n||0}}async function i(a){let c=await (0,b.createClient)(),e=d(a),f=a=>{let b=c.from("review_articles").select(a?"id, contractor:review_contractors(id, business_name)":"id",{count:"exact",head:!0});return e&&(b=a?b.or(`title.ilike.%${e}%,contractor.business_name.ilike.%${e}%`):b.ilike("title",`%${e}%`)),b},[g,h,i]=await Promise.all([f(!0),f(!0).eq("status","published"),f(!0).eq("status","draft")]);if(g.error||h.error||i.error){if(!a)return console.error("Error fetching article status counts:",{total:g.error,published:h.error,draft:i.error}),{total:0,published:0,draft:0};let[b,c,d]=await Promise.all([f(!1),f(!1).eq("status","published"),f(!1).eq("status","draft")]);return b.error||c.error||d.error?(console.error("Error fetching fallback article status counts:",{total:b.error,published:c.error,draft:d.error}),{total:0,published:0,draft:0}):{total:b.count||0,published:c.count||0,draft:d.count||0}}return{total:g.count||0,published:h.count||0,draft:i.count||0}}async function j(a){let c=await (0,b.createClient)(),{data:d,error:e}=await c.from("review_articles").select(`
      id,
      contractor_id,
      title,
      slug,
      content_markdown,
      metadata_json,
      model_used,
      tokens_used,
      cost_estimate,
      status,
      generated_at,
      contractor:review_contractors(id, business_name, city, state, rating, review_count)
    `).eq("id",a).single();if(e){if("PGRST116"===e.code)return null;throw console.error("Error fetching article by id:",e),e}return{...d,contractor:Array.isArray(d.contractor)?d.contractor[0]:d.contractor}}async function k(a,c=1,e=20){let f=await (0,b.createClient)(),g=d(a?.search),h=(c-1)*e,i=f.from("review_data").select(`
      id,
      contractor_id,
      reviewer_name,
      rating,
      review_text,
      review_date,
      owner_response,
      review_url,
      collected_at,
      contractor:review_contractors(id, business_name, city, state)
    `,{count:"exact"});a?.rating&&(i=i.eq("rating",a.rating)),g&&(i=i.or(`review_text.ilike.%${g}%,reviewer_name.ilike.%${g}%`)),a?.hasOwnerResponse!==void 0&&(i=a.hasOwnerResponse?i.not("owner_response","is",null):i.is("owner_response",null)),i=i.range(h,h+e-1).order("review_date",{ascending:!1,nullsFirst:!1});let{data:j,count:l,error:m}=await i;if(m)throw console.error("Error fetching reviews:",m),m;let n=0,o=0,p=0,q=f.from("review_data").select("avg_rating:avg(rating), total_reviews:count(*), responses:count(owner_response)");a?.rating&&(q=q.eq("rating",a.rating)),g&&(q=q.or(`review_text.ilike.%${g}%,reviewer_name.ilike.%${g}%`)),a?.hasOwnerResponse!==void 0&&(q=a.hasOwnerResponse?q.not("owner_response","is",null):q.is("owner_response",null));let{data:r,error:s}=await q;if(s||!r||0===r.length){let b=f.from("review_data").select("rating, owner_response");a?.rating&&(b=b.eq("rating",a.rating)),g&&(b=b.or(`review_text.ilike.%${g}%,reviewer_name.ilike.%${g}%`)),a?.hasOwnerResponse!==void 0&&(b=a.hasOwnerResponse?b.not("owner_response","is",null):b.is("owner_response",null));let c=(await b).data||[];n=c.length,o=c.reduce((a,b)=>a+(b.rating||0),0),p=c.filter(a=>a.owner_response).length}else{let a=r[0];n=a.total_reviews||0,o=(a.avg_rating||0)*n,p=a.responses||0}return{data:(j||[]).map(a=>({...a,contractor:Array.isArray(a.contractor)?a.contractor[0]:a.contractor})),total:l||0,stats:{avgRating:n>0?o/n:0,responseRate:n>0?p/n*100:0}}}async function l(a=10){let c=await (0,b.createClient)(),[d,e,f]=await Promise.all([c.from("review_contractors").select("id, business_name, discovered_at").order("discovered_at",{ascending:!1}).limit(a),c.from("review_analysis").select(`
        id,
        analyzed_at,
        contractor:review_contractors(id, business_name)
      `).order("analyzed_at",{ascending:!1}).limit(a),c.from("review_articles").select(`
        id,
        generated_at,
        contractor:review_contractors(id, business_name)
      `).order("generated_at",{ascending:!1}).limit(a)]);return d.error&&console.error("Error fetching recent contractors:",d.error),e.error&&console.error("Error fetching recent analyses:",e.error),f.error&&console.error("Error fetching recent articles:",f.error),{recentContractors:d.data||[],recentAnalyses:(e.data||[]).map(a=>({...a,contractor:a.contractor})),recentArticles:(f.data||[]).map(a=>({...a,contractor:a.contractor}))}}let m=(0,c.unstable_cache)(async()=>{let a=(0,b.createAdminClient)(),{data:c,error:d}=await a.rpc("get_unique_cities");if(!d&&c)return c.map(a=>a.city).filter(Boolean);let{data:e,error:f}=await a.from("review_contractors").select("city").order("city");if(f)throw console.error("Error fetching cities:",f),f;return Array.from(new Set((e||[]).map(a=>a.city))).filter(Boolean)},["contractor-filter-cities"],{revalidate:3600,tags:["contractor-filters"]}),n=(0,c.unstable_cache)(async()=>{let a=(0,b.createAdminClient)(),{data:c,error:d}=await a.rpc("get_unique_states");if(!d&&c)return c.map(a=>a.state).filter(Boolean);let{data:e,error:f}=await a.from("review_contractors").select("state").order("state");if(f)throw console.error("Error fetching states:",f),f;return Array.from(new Set((e||[]).map(a=>a.state))).filter(Boolean)},["contractor-filter-states"],{revalidate:3600,tags:["contractor-filters"]});async function o(a){let c=(await (0,b.createClient)()).from("ai_usage_log").select("operation, total_tokens, cost_estimate, success");a?.operation&&(c=c.eq("operation",a.operation)),a?.success!==void 0&&(c=c.eq("success",a.success)),a?.since&&(c=c.gte("created_at",a.since)),a?.until&&(c=c.lte("created_at",a.until));let{data:d,error:e}=await c;if(e)return console.error("Error fetching AI usage stats:",e),{totalOperations:0,totalTokens:0,totalInputTokens:0,totalOutputTokens:0,totalCost:0,avgCostPerOperation:0,avgTokensPerOperation:0,byOperation:{analyze:{count:0,tokens:0,inputTokens:0,outputTokens:0,cost:0},generate:{count:0,tokens:0,inputTokens:0,outputTokens:0,cost:0},discover:{count:0,tokens:0,inputTokens:0,outputTokens:0,cost:0}},successRate:0};let f=d||[],g=f.length,h=f.reduce((a,b)=>a+(b.total_tokens||0),0),i=f.reduce((a,b)=>a+(b.input_tokens||0),0),j=f.reduce((a,b)=>a+(b.output_tokens||0),0),k=f.reduce((a,b)=>a+Number(b.cost_estimate||0),0),l=f.filter(a=>a.success).length,m={analyze:{count:0,tokens:0,inputTokens:0,outputTokens:0,cost:0},generate:{count:0,tokens:0,inputTokens:0,outputTokens:0,cost:0},discover:{count:0,tokens:0,inputTokens:0,outputTokens:0,cost:0}};return f.forEach(a=>{let b=a.operation;m[b]&&(m[b].count++,m[b].tokens+=a.total_tokens||0,m[b].inputTokens+=a.input_tokens||0,m[b].outputTokens+=a.output_tokens||0,m[b].cost+=Number(a.cost_estimate||0))}),{totalOperations:g,totalTokens:h,totalInputTokens:i,totalOutputTokens:j,totalCost:k,avgCostPerOperation:g>0?k/g:0,avgTokensPerOperation:g>0?h/g:0,byOperation:m,successRate:g>0?l/g*100:0}}async function p(a,c=1,d=50,e="created_at",f="desc"){let g=await (0,b.createClient)(),h=(c-1)*d,i=g.from("ai_usage_log").select(`
      *,
      contractor:review_contractors(id, business_name, city, state)
    `,{count:"exact"});a?.operation&&(i=i.eq("operation",a.operation)),a?.success!==void 0&&(i=i.eq("success",a.success)),a?.since&&(i=i.gte("created_at",a.since)),a?.until&&(i=i.lte("created_at",a.until));let j=["created_at","total_tokens","cost_estimate","duration_ms"].includes(e)?e:"created_at";i=i.range(h,h+d-1).order(j,{ascending:"asc"===f});let{data:k,count:l,error:m}=await i;return m?(console.error("Error fetching AI usage logs:",m),{data:[],total:0}):{data:k||[],total:l||0}}async function q(a=30){let c=await (0,b.createClient)(),d=new Date;d.setDate(d.getDate()-a);let{data:e,error:f}=await c.from("ai_usage_log").select("created_at, total_tokens, cost_estimate").gte("created_at",d.toISOString()).order("created_at",{ascending:!0});if(f)return console.error("Error fetching daily cost trend:",f),[];let g={};return(e||[]).forEach(a=>{let b=a.created_at.split("T")[0];g[b]||(g[b]={date:b,cost:0,tokens:0,operations:0}),g[b].cost+=Number(a.cost_estimate||0),g[b].tokens+=a.total_tokens||0,g[b].operations++}),Object.values(g).sort((a,b)=>a.date.localeCompare(b.date))}async function r(){let a=await (0,b.createClient)(),{data:c,error:d}=await a.from("ai_usage_log").select("model, total_tokens, cost_estimate, duration_ms, success");if(d)return console.error("Error fetching model stats:",d),[];let e={};return(c||[]).forEach(a=>{let b=a.model||"unknown";e[b]||(e[b]={totalOps:0,totalTokens:0,totalCost:0,totalDuration:0,successCount:0,durationCount:0}),e[b].totalOps++,e[b].totalTokens+=a.total_tokens||0,e[b].totalCost+=Number(a.cost_estimate||0),a.duration_ms&&(e[b].totalDuration+=a.duration_ms,e[b].durationCount++),a.success&&e[b].successCount++}),Object.entries(e).map(([a,b])=>({model:a,totalOperations:b.totalOps,totalTokens:b.totalTokens,totalCost:b.totalCost,avgDuration:b.durationCount>0?b.totalDuration/b.durationCount:0,successRate:b.totalOps>0?b.successCount/b.totalOps*100:0}))}async function s(a){let c=(await (0,b.createClient)()).from("ai_usage_log").select("duration_ms").not("duration_ms","is",null);a?.operation&&(c=c.eq("operation",a.operation)),a?.success!==void 0&&(c=c.eq("success",a.success)),a?.since&&(c=c.gte("created_at",a.since)),a?.until&&(c=c.lte("created_at",a.until));let{data:d,error:e}=await c;if(e)return console.error("Error fetching duration distribution:",e),[];let f=[{label:"<1s",min:0,max:1e3,count:0},{label:"1-3s",min:1e3,max:3e3,count:0},{label:"3-5s",min:3e3,max:5e3,count:0},{label:"5-10s",min:5e3,max:1e4,count:0},{label:"10-30s",min:1e4,max:3e4,count:0},{label:"30s+",min:3e4,max:1/0,count:0}];return(d||[]).forEach(a=>{let b=a.duration_ms;for(let a of f)if(b>=a.min&&b<a.max){a.count++;break}}),f}async function t(a=10){let c=await (0,b.createClient)(),{data:d,error:e}=await c.from("ai_usage_log").select(`
      contractor_id,
      total_tokens,
      cost_estimate,
      contractor:review_contractors(id, business_name, city, state)
    `).not("contractor_id","is",null);if(e)return console.error("Error fetching top contractors by cost:",e),[];let f={};return(d||[]).forEach(a=>{let b=a.contractor_id;b&&a.contractor&&(f[b]||(f[b]={contractor_id:b,business_name:a.contractor.business_name||"Unknown",city:a.contractor.city,state:a.contractor.state,totalCost:0,totalTokens:0,totalOperations:0}),f[b].totalCost+=Number(a.cost_estimate||0),f[b].totalTokens+=a.total_tokens||0,f[b].totalOperations++)}),Object.values(f).sort((a,b)=>b.totalCost-a.totalCost).slice(0,a)}async function u(a,c=1,d=50,e="searched_at",f="desc"){let g=await (0,b.createClient)(),h=(c-1)*d,i=g.from("searched_cities").select("*",{count:"exact"});a?.city&&(i=i.ilike("city",`%${a.city}%`)),a?.state&&(i=i.eq("state",a.state)),a?.searchTerm&&(i=i.ilike("search_term",`%${a.searchTerm}%`));let j=["searched_at","contractors_found","city"].includes(e)?e:"searched_at";i=i.range(h,h+d-1).order(j,{ascending:"asc"===f});let{data:k,count:l,error:m}=await i;return m?(console.error("Error fetching search history:",m),{data:[],total:0}):{data:k||[],total:l||0}}async function v(a){let c=await (0,b.createClient)(),d=c.from("searched_cities").select("*",{count:"exact",head:!0});a?.city&&(d=d.eq("city",a.city)),a?.state&&(d=d.eq("state",a.state));let{count:e,error:f}=await d;if(f)return console.error("Error fetching search stats:",f),{totalSearches:0,totalContractorsFound:0,uniqueCities:0,uniqueStates:0};let g=c.from("searched_cities").select("contractors_found"),h=c.from("searched_cities").select("city"),i=c.from("searched_cities").select("state");a?.city&&(g=g.eq("city",a.city),h=h.eq("city",a.city),i=i.eq("city",a.city)),a?.state&&(g=g.eq("state",a.state),h=h.eq("state",a.state),i=i.eq("state",a.state));let[j,k,l]=await Promise.all([g,h,i]),m=(j.data||[]).reduce((a,b)=>a+(b.contractors_found||0),0);return{totalSearches:e||0,totalContractorsFound:m,uniqueCities:new Set((k.data||[]).map(a=>a.city)).size,uniqueStates:new Set((l.data||[]).map(a=>a.state).filter(Boolean)).size}}async function w(){let a=await (0,b.createClient)(),[c,d]=await Promise.all([a.from("searched_cities").select("state").order("state"),a.from("searched_cities").select("city").order("city").limit(500)]);return{states:[...new Set((c.data||[]).map(a=>a.state).filter(a=>!!a))].sort(),cities:[...new Set((d.data||[]).map(a=>a.city))].sort()}}async function x(){let a=await (0,b.createClient)(),{data:c,error:d}=await a.from("searched_cities").select("city, state, search_term").limit(1e4);if(d)return console.error("Error fetching duplicates:",d),[];let e={};for(let a of c||[]){let b=`${a.city}|${a.state||""}|${a.search_term}`;e[b]=(e[b]||0)+1}return Object.entries(e).filter(([,a])=>a>1).map(([a])=>a)}async function y(){let a=await (0,b.createClient)(),{data:c,error:d}=await a.from("ai_usage_log").select("operation, duration_ms, created_at").order("created_at",{ascending:!1});if(d)return console.error("Error fetching pipeline timing:",d),{discover:{avgDuration:null,lastRun:null,totalRuns:0},analyze:{avgDuration:null,lastRun:null,totalRuns:0},generate:{avgDuration:null,lastRun:null,totalRuns:0}};let e=c||[],f=a=>{let b=e.filter(b=>b.operation===a),c=b.filter(a=>a.duration_ms),d=c.reduce((a,b)=>a+(b.duration_ms||0),0);return{avgDuration:c.length>0?Math.round(d/c.length):null,lastRun:b.length>0?b[0].created_at:null,totalRuns:b.length}};return{discover:f("discover"),analyze:f("analyze"),generate:f("generate")}}a.s(["getAIUsageLogs",()=>p,"getAIUsageStats",()=>o,"getArticleById",()=>j,"getArticleStatusCounts",()=>i,"getArticles",()=>h,"getCachedCities",0,m,"getCachedStates",0,n,"getContractorDetail",()=>g,"getContractors",()=>f,"getDailyCostTrend",()=>q,"getDuplicateKeysOptimized",()=>x,"getDurationDistribution",()=>s,"getGlobalFilterOptions",()=>w,"getModelStats",()=>r,"getPipelineStats",()=>e,"getPipelineTimingStats",()=>y,"getRecentActivity",()=>l,"getReviews",()=>k,"getSearchHistory",()=>u,"getSearchStatsOptimized",()=>v,"getTopContractorsByCost",()=>t])}];

//# sourceMappingURL=_dd9202ab._.js.map