{
  "meta": {
    "name": "Payload CMS Integration - MVP",
    "description": "Add Payload CMS to KnearMe for marketing content management, starting with FAQ and Pricing sections",
    "created": "2026-01-12",
    "version": "1.0.0",
    "interview_summary": "Colocated Payload CMS deployment using existing Supabase PostgreSQL. MVP scope: FAQ collection (7 items) and Pricing tiers (2 plans). Zero additional hosting cost by running Payload inside the existing Next.js app."
  },
  "config": {
    "priority_order": ["critical", "high", "medium", "low"],
    "categories": ["setup", "collections", "integration", "migration", "testing"]
  },
  "features": [
    {
      "id": "PAY-001",
      "category": "setup",
      "priority": "critical",
      "description": "Install Payload CMS dependencies and configure for Next.js 14 colocated deployment",
      "acceptance_criteria": [
        "payload, @payloadcms/next, @payloadcms/db-postgres, @payloadcms/richtext-lexical packages installed",
        "payload.config.ts created at /src/payload/payload.config.ts with Supabase connection",
        "PAYLOAD_SECRET and DATABASE_URL environment variables documented in .env.example",
        "TypeScript types generate to /src/types/payload-types.ts"
      ],
      "verification_steps": [
        "Run npm install and verify no dependency conflicts",
        "Run npx payload generate:types and verify types file created",
        "Verify DATABASE_URL points to Supabase PostgreSQL connection string format"
      ],
      "dependencies": [],
      "notes": "Use separate 'payload' schema in PostgreSQL to avoid conflicts with existing Supabase tables. Connection string format: postgresql://postgres:[password]@db.[project-ref].supabase.co:5432/postgres",
      "passes": false
    },
    {
      "id": "PAY-002",
      "category": "setup",
      "priority": "critical",
      "description": "Create Payload API route handler for REST endpoints",
      "acceptance_criteria": [
        "API route created at /src/app/api/[...payload]/route.ts",
        "Route exports GET, POST, PATCH, PUT, DELETE handlers from @payloadcms/next",
        "Payload config imported correctly from @/payload/payload.config"
      ],
      "verification_steps": [
        "Start dev server and verify /api/payload endpoints respond",
        "Test GET /api/faqs returns empty array (before seeding)"
      ],
      "dependencies": ["PAY-001"],
      "notes": "This creates the REST API that Next.js components will fetch content from",
      "passes": false
    },
    {
      "id": "PAY-003",
      "category": "setup",
      "priority": "critical",
      "description": "Create Payload admin panel route with catch-all segments",
      "acceptance_criteria": [
        "Admin route created at /src/app/(admin)/admin/[[...segments]]/page.tsx",
        "Route renders Payload AdminPanel component",
        "Admin panel accessible at /admin URL"
      ],
      "verification_steps": [
        "Navigate to http://localhost:3000/admin",
        "Verify Payload admin login screen appears",
        "Create first admin user and verify login works"
      ],
      "dependencies": ["PAY-001"],
      "notes": "Uses Next.js catch-all route to handle all admin sub-routes. First user created becomes admin.",
      "passes": false
    },
    {
      "id": "PAY-004",
      "category": "setup",
      "priority": "critical",
      "description": "Update Next.js middleware to exclude Payload routes from Supabase auth",
      "acceptance_criteria": [
        "middleware.ts matcher pattern excludes /admin and /api/payload routes",
        "Payload admin panel loads without Supabase session interference",
        "Existing Supabase auth routes continue working"
      ],
      "verification_steps": [
        "Access /admin without being logged into Supabase auth",
        "Verify contractor dashboard still requires Supabase auth",
        "Verify /api/payload endpoints accessible"
      ],
      "dependencies": ["PAY-003"],
      "notes": "Critical to prevent auth conflicts. Payload has its own auth system for CMS users.",
      "passes": false
    },
    {
      "id": "PAY-005",
      "category": "collections",
      "priority": "critical",
      "description": "Create Users collection for Payload admin authentication",
      "acceptance_criteria": [
        "Users collection created at /src/payload/collections/Users.ts",
        "Collection has auth: true enabled",
        "Fields include: email (required), name, role (admin/editor select)",
        "Collection registered in payload.config.ts"
      ],
      "verification_steps": [
        "Create admin user via /admin first-run flow",
        "Verify user appears in Payload admin Users list",
        "Verify role field saves correctly"
      ],
      "dependencies": ["PAY-001"],
      "notes": "Separate from Supabase auth.users - this is only for CMS admin access",
      "passes": false
    },
    {
      "id": "PAY-006",
      "category": "collections",
      "priority": "high",
      "description": "Create FAQs collection with question, answer, category, and ordering fields",
      "acceptance_criteria": [
        "FAQs collection created at /src/payload/collections/FAQs.ts",
        "Fields: question (text, required), answer (richText, required), category (select), order (number), showOnLanding (checkbox)",
        "Category options: general, pricing, features, technical",
        "Admin UI uses question as title field",
        "Collection registered in payload.config.ts"
      ],
      "verification_steps": [
        "Navigate to /admin/collections/faqs",
        "Create a test FAQ with all fields",
        "Verify FAQ appears in list sorted by order field",
        "Verify rich text editor works for answer field"
      ],
      "dependencies": ["PAY-005"],
      "notes": "Mirrors structure from existing hardcoded FAQ in /src/components/marketing/FAQ.tsx",
      "passes": false
    },
    {
      "id": "PAY-007",
      "category": "collections",
      "priority": "high",
      "description": "Create PricingTiers collection with tier details and feature lists",
      "acceptance_criteria": [
        "PricingTiers collection created at /src/payload/collections/PricingTiers.ts",
        "Fields: name (text), description (text), monthlyPrice (number), yearlyPrice (number), features (array of text), ctaText (text), ctaLink (text), isHighlighted (checkbox), badge (text optional), order (number)",
        "Admin UI uses name as title field",
        "Collection registered in payload.config.ts"
      ],
      "verification_steps": [
        "Navigate to /admin/collections/pricing-tiers",
        "Create Free and Pro tiers matching existing pricing",
        "Verify features array allows adding multiple items",
        "Verify highlighted checkbox renders correctly"
      ],
      "dependencies": ["PAY-005"],
      "notes": "Mirrors structure from existing hardcoded Pricing in /src/components/marketing/Pricing.tsx",
      "passes": false
    },
    {
      "id": "PAY-008",
      "category": "integration",
      "priority": "high",
      "description": "Create Payload client helper with typed query functions for FAQs and Pricing",
      "acceptance_criteria": [
        "Client helper created at /src/lib/payload/client.ts",
        "getPayload() function returns cached Payload client",
        "getFAQs() returns FAQs sorted by order, filtered by showOnLanding if specified",
        "getPricingTiers() returns tiers sorted by order",
        "Functions use generated Payload types for type safety"
      ],
      "verification_steps": [
        "Import getFAQs in a test file and verify TypeScript types",
        "Call getFAQs() and verify returns array of FAQ documents",
        "Call getPricingTiers() and verify returns array of tier documents"
      ],
      "dependencies": ["PAY-006", "PAY-007"],
      "notes": "These helper functions will be used by Server Components to fetch CMS content",
      "passes": false
    },
    {
      "id": "PAY-009",
      "category": "migration",
      "priority": "high",
      "description": "Seed existing FAQ content from hardcoded component into Payload",
      "acceptance_criteria": [
        "Seed script created at /src/payload/seed/faqs.ts",
        "All 7 existing FAQs from FAQ.tsx migrated to Payload",
        "FAQ content preserves original question/answer text exactly",
        "Categories assigned appropriately (general, pricing, features)",
        "Order numbers set to match original display order",
        "showOnLanding set to true for all"
      ],
      "verification_steps": [
        "Run seed script via npx tsx src/payload/seed/faqs.ts",
        "Verify 7 FAQs appear in /admin/collections/faqs",
        "Compare FAQ text against original FAQ.tsx to confirm accuracy"
      ],
      "dependencies": ["PAY-006"],
      "notes": "Original FAQs: phone usage, speaking ability, Google timing, editing, cancellation, backups, refunds",
      "passes": false
    },
    {
      "id": "PAY-010",
      "category": "migration",
      "priority": "high",
      "description": "Seed existing Pricing content from hardcoded component into Payload",
      "acceptance_criteria": [
        "Seed script created at /src/payload/seed/pricing.ts",
        "Free tier: $0, 5 projects, feature list from Pricing.tsx",
        "Pro tier: $29/month, $290/year, unlimited projects, feature list from Pricing.tsx",
        "Pro tier marked as highlighted with 'Most Popular' badge",
        "Order: Free=1, Pro=2"
      ],
      "verification_steps": [
        "Run seed script via npx tsx src/payload/seed/pricing.ts",
        "Verify 2 tiers appear in /admin/collections/pricing-tiers",
        "Compare pricing details against original Pricing.tsx"
      ],
      "dependencies": ["PAY-007"],
      "notes": "Preserve exact feature text and pricing numbers from existing component",
      "passes": false
    },
    {
      "id": "PAY-011",
      "category": "integration",
      "priority": "high",
      "description": "Update FAQ component to fetch content from Payload instead of hardcoded array",
      "acceptance_criteria": [
        "FAQ.tsx converted to async Server Component",
        "Component calls getFAQs() from /src/lib/payload/client.ts",
        "Renders FAQ items from Payload data",
        "Falls back to hardcoded content if Payload fetch fails",
        "Rich text answer rendered correctly (handle Lexical format)"
      ],
      "verification_steps": [
        "Load landing page and verify FAQ section renders",
        "Edit an FAQ in Payload admin and verify change appears on page (after refresh/revalidate)",
        "Disconnect Payload and verify fallback renders original content"
      ],
      "dependencies": ["PAY-008", "PAY-009"],
      "notes": "Keep original hardcoded array as fallback for resilience. Use try/catch wrapper.",
      "passes": false
    },
    {
      "id": "PAY-012",
      "category": "integration",
      "priority": "high",
      "description": "Update Pricing component to fetch content from Payload instead of hardcoded tiers",
      "acceptance_criteria": [
        "Pricing.tsx receives tier data as props from parent Server Component",
        "Parent page.tsx fetches pricing via getPricingTiers()",
        "Component renders tier cards from Payload data",
        "Monthly/yearly toggle still works with Payload price data",
        "Falls back to hardcoded tiers if Payload fetch fails"
      ],
      "verification_steps": [
        "Load landing page and verify Pricing section renders with both tiers",
        "Toggle monthly/yearly and verify prices update correctly",
        "Edit a tier price in Payload admin and verify change appears",
        "Verify highlighted tier has correct styling"
      ],
      "dependencies": ["PAY-008", "PAY-010"],
      "notes": "Pricing component is currently client component for toggle state. Pass data from server parent.",
      "passes": false
    },
    {
      "id": "PAY-013",
      "category": "testing",
      "priority": "medium",
      "description": "Add ISR revalidation for CMS content with 1-hour cache",
      "acceptance_criteria": [
        "Landing page uses revalidate: 3600 for Payload content",
        "FAQ and Pricing sections cache properly",
        "Content updates visible within 1 hour without redeploy"
      ],
      "verification_steps": [
        "Deploy to Vercel preview",
        "Edit content in Payload admin",
        "Verify content updates after cache expires or manual revalidation"
      ],
      "dependencies": ["PAY-011", "PAY-012"],
      "notes": "ISR ensures good performance while allowing content updates without builds",
      "passes": false
    },
    {
      "id": "PAY-014",
      "category": "testing",
      "priority": "medium",
      "description": "Document Payload admin access and content editing workflow",
      "acceptance_criteria": [
        "README section added for Payload CMS usage",
        "Documents how to access /admin panel",
        "Documents how to create/edit FAQs",
        "Documents how to update pricing tiers",
        "Notes about cache timing (1 hour ISR)"
      ],
      "verification_steps": [
        "Non-technical user can follow docs to edit an FAQ",
        "Documentation accurately describes current workflow"
      ],
      "dependencies": ["PAY-013"],
      "notes": "Keep docs minimal - focus on common editing tasks",
      "passes": false
    },
    {
      "id": "PAY-015",
      "category": "setup",
      "priority": "low",
      "description": "Add PAYLOAD_SECRET to Vercel environment variables for production",
      "acceptance_criteria": [
        "PAYLOAD_SECRET added to Vercel project settings",
        "Secret is at least 32 characters",
        "Production build succeeds with Payload initialized"
      ],
      "verification_steps": [
        "Deploy to Vercel production",
        "Verify /admin panel loads in production",
        "Verify admin login works"
      ],
      "dependencies": ["PAY-013"],
      "notes": "Generate secure secret with: openssl rand -base64 32",
      "passes": false
    }
  ]
}
